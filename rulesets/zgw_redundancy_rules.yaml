rules:
  # Rule 1: Ensures that allOf is not used with a single reference
  #
  # Example:
  #   allOf:
  #     - $ref: "#/components/schemas/User"    # this should be simplified to one ref
  #
  # Invalid example:
  #   allOf:
  #     - $ref: "#/components/schemas/User"
  #     - $ref: "#/components/schemas/Product"  # multiple references are OK
  redundant-allof:
    description: Detects allOf with single reference that can be simplified
    message: Single allOf with single item detected. Consider replacing it with a single reference.
    severity: warn
    given: $..*
    then:
      function: schema
      functionOptions:
        schema:
          if:
            type: object
            properties:
              allOf:
                type: array
                maxItems: 1
                minItems: 1
            required: [allOf]
            maxProperties: 1
          then: false
